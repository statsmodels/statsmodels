# R code to dump fair test dataset to 
# checking compatibility.
#
# Usage:
#   Rscript test_get_R_tweedie_var_weight.R > res_R_var_weight.py
cat("# This file auto-generated by test_get_R_tweedie_var_weight.R\n")
cat(sprintf("# Using: %s\n", R.Version()$version.string))
cat("import numpy as np\n")

require(statmod)

options(digits=20)
x <- (1.5)^(0:19)

MISSING <- "MISSING"

is.missing <- function(obj) {
  length(obj) == 1 && obj == MISSING
}

pyprint <- function(arr, prefix=NULL, suffix=NULL) {
  if (!is.null(prefix)) {
    cat(prefix)
  }
  if (is.missing(arr)) {
    cat("None\n")
  } else {
    cat("np.array([")
    for (val in arr) {
      cat(val)
      cat(", ")
    }
    cat("])")
    if (!is.null(dim(arr))) {
      cat(".reshape((")
      for (size in dim(arr)) {
        cat(sprintf("%s, ", size))
      }
      cat("), order=\"F\")")
    }
  }
  if (!is.null(suffix)) {
    cat(sprintf("%s \n", suffix))
  }
  else {
    cat("\n")
  }
}

data = read.csv('../statsmodels/datasets/fair/fair.csv')
data$weights <- rep(1, length(data$rate_marriage))
data$weights[seq(1, length(data$rate_marriage), 5)] <- 5
data$weights[seq(1, length(data$rate_marriage), 13)] <- 3

model <- glm(affairs ~ 1 + age + yrs_married,
             data = data,
             family = tweedie(var.power = 1.55, link.power = 0),
             weights = weights)

cat("res = dict() \n")
pyprint(model$coefficients, prefix = "res['params'] = ")
pyprint(diag(vcov(model))^0.5, prefix = "res['bse'] = ")
cat(sprintf("res['deviance'] = %f \n", model$deviance))

cat("res['ll'] = np.nan \n")

cat("res['resids_colnames'] = ['resid_response', 'resid_pearson', 'resid_deviance', 'resid_working'] \n" )

r <- cbind(residuals.glm(model, 'response'),
           residuals.glm(model, 'pearson'),
           residuals.glm(model, 'deviance'),
           residuals.glm(model, 'working'))


pyprint(r, "res['resids'] = ")

cat("
class Bunch(dict):
    def __init__(self, **kw):
        dict.__init__(self, kw)
        self.__dict__  = self

res = Bunch(
    **res
)
")
